### 综合大报告

一、需求分析

（1）描述系统功能

1. 用户登录、注册和登出；
2. 个人信息维护；
3. 浏览商品并通过输入关键词搜索商品；
4. 点击货架、购物车和订单中的商品项，可查看详情并添加到购物车；
5. 在购物车中编辑待购买的商品数量；
6. 一次性购买购物车中所有选中的商品；
7. 先买先得，库存不足的按最大数量购买；
8. 删除购物车中的商品
9. 生成订单，可在订单页面查看；
10. 取消、删除订单
11. 通过日期编辑，查看每日、每月消费统计；
12. 促销，支持满减和直接打折、比例折扣和定价折扣之间两两组合；
13. 单商品有多重促销时，采用最大力度的一种优惠
14. 服务端日志记录

（2）分析重点难点

1. 控制页面显示内容区分登录与未登录用户的权限，例如未登录用户可浏览商店、查看商品详情、查看促销消息等，但不能查看购物车、订单、消费统计和个人信息，这部分内容只有对登录的用户显示。
2. 解决客户端不能获取服务端最新状态的问题：通过设计刷新和同步按钮，用户可手动从服务端得到最新数据，也可将客户端数据同步到远程。
3. 需要管理持久层数据（如添加商品）的问题：利用数据库可视化工具（如SQLiteStudio），管理员可对数据库中的数据进行全面查询和管理。
4. 多种商品、多条促销之间具有多对多的关系，对于这种关系的表示方法：在数据库中创建商品-促销关系表，将关系ID、商品ID与促销ID作为一条记录。

（3）技术难点说明

1. 同一个套接字发送多次数据，会导致多份数据被服务端一并解析，出现数据解析错误问题（粘包）。故需要在每份数据前添加固定长度的长度前缀，使服务端先解析待接收的数据长度，然后根据该长度精确解析随后的数据。
2. 为解决涉及用户隐私的数据传输安全问题，采用SHA-256算法构造授权令牌和加密明文密码，防止伪造请求和隐私泄露。
3. 程序中多有异步操作，所以要禁用所有阻塞当前进程的操作（例如弹窗提示），改用异步实现，否则将导致内存意外释放、程序崩溃等。

二、设计

（1）功能模块划分

（2）类图及说明

（3）数据库定义

（4）UI设计

（5）协议设计

（6）设计模式使用

三、实现

（1）编译环境

（2）核心流程

（3）核心方法

（4）核心功能实现

四、相关技术讨论

（1）持久层使用

（2）SQL

（3）多线程

（4）容器的使用

五、难点问题讨论

六、收获和展望
